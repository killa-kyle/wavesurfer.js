"use strict";WaveSurfer.Regions={init:function(e){this.wavesurfer=e,this.wrapper=this.wavesurfer.drawer.wrapper,this.list={}},add:function(e){var t=Object.create(WaveSurfer.Region);return t.init(e,this.wavesurfer),this.list[t.id]=t,t.on("remove",function(){delete this.list[t.id]}.bind(this)),t},clear:function(){Object.keys(this.list).forEach(function(e){this.list[e].remove()},this)},enableDragSelection:function(e){var t=this,r,i,n;this.wrapper.addEventListener("mousedown",function(e){r=!0,i=t.wavesurfer.drawer.handleEvent(e),n=null}),this.wrapper.addEventListener("mouseup",function(){r=!1,n=null}),this.wrapper.addEventListener("mousemove",function(s){if(r){n||(n=t.add(e||{}));var a=t.wavesurfer.getDuration(),o=t.wavesurfer.drawer.handleEvent(s);n.update({start:Math.min(o*a,i*a),end:Math.max(o*a,i*a)})}})}},WaveSurfer.Region={style:WaveSurfer.Drawer.style,init:function(e,t){this.wavesurfer=t,this.wrapper=t.drawer.wrapper,this.id=null==e.id?WaveSurfer.util.getId():e.id,this.start=Number(e.start)||0,this.end=null==e.end?this.start+4/this.wrapper.scrollWidth*this.wavesurfer.getDuration():Number(e.end),this.resize=void 0===e.resize?!0:Boolean(e.resize),this.drag=void 0===e.drag?!0:Boolean(e.drag),this.loop=Boolean(e.loop),this.color=e.color||"rgba(0, 0, 0, 0.1)",this.data=e.data||{},this.bindInOut(),this.render(),this.wavesurfer.fireEvent("region-created",this)},update:function(e){null!=e.start&&(this.start=Number(e.start)),null!=e.end&&(this.end=Number(e.end)),null!=e.loop&&(this.color=Boolean(e.loop)),null!=e.color&&(this.color=e.color),null!=e.data&&(this.data=e.data),null!=e.resize&&(this.data=Boolean(e.resize)),null!=e.drag&&(this.data=Boolean(e.drag)),this.updateRender(),this.fireEvent("update"),this.wavesurfer.fireEvent("region-updated",this)},remove:function(e){this.element&&(this.wrapper.removeChild(this.element),this.element=null,this.fireEvent("remove"),this.wavesurfer.fireEvent("region-removed",this))},play:function(){this.wavesurfer.play(this.start,this.end),this.fireEvent("play"),this.wavesurfer.fireEvent("region-play",this)},playLoop:function(){this.play(),this.once("out",this.playLoop.bind(this))},render:function(){var e=document.createElement("region");e.className="wavesurfer-region",e.title=this.formatTime(this.start,this.end);var t=this.wrapper.scrollWidth;if(this.style(e,{cursor:"move",position:"absolute",zIndex:2,height:"100%",top:"0px"}),this.resize){var r=e.appendChild(document.createElement("handle")),i=e.appendChild(document.createElement("handle"));r.className="wavesurfer-handle wavesurfer-handle-start",i.className="wavesurfer-handle wavesurfer-handle-end";var n={cursor:"ew-resize",position:"absolute",left:"0px",top:"0px",width:"2%",maxWidth:"4px",height:"100%"};this.style(r,n),this.style(i,n),this.style(i,{left:"100%"})}this.element=this.wrapper.appendChild(e),this.updateRender(),this.bindEvents(e)},formatTime:function(e,t){return(t?[e,t]:[e]).map(function(e){return[Math.floor(e%3600/60),("00"+Math.floor(e%60)).slice(-2)].join(":")}).join("â€“")},updateRender:function(){var e=this.wavesurfer.getDuration(),t=this.wrapper.scrollWidth,r=this.end-this.start;this.start<0&&(this.start=0,this.end=r),this.end>e&&(this.end=e,this.start=e-r),this.style(this.element,{left:~~(this.start/e*t)+"px",width:~~((this.end/e-this.start/e)*t)+"px",backgroundColor:this.color}),this.element.title=this.formatTime(this.start,this.end)},bindInOut:function(){var e=this,t=function(){e.firedIn=!1,e.firedOut=!1},r=function(t){!e.firedIn&&e.start<=t&&e.end>t&&(e.firedIn=!0,e.fireEvent("in"),e.wavesurfer.fireEvent("region-in",e)),!e.firedOut&&e.firedIn&&e.end<=t&&(e.firedOut=!0,e.fireEvent("out"),e.wavesurfer.fireEvent("region-out",e))};this.wavesurfer.on("play",t),this.wavesurfer.backend.on("audioprocess",r),this.on("remove",function(){e.wavesurfer.un("play",t),e.wavesurfer.backend.un("audioprocess",r)}),this.on("out",function(){e.loop&&e.wavesurfer.play(e.start)})},bindEvents:function(){var e=this;this.element.addEventListener("mouseenter",function(t){e.fireEvent("mouseenter",t),e.wavesurfer.fireEvent("region-mouseenter",e,t)}),this.element.addEventListener("mouseleave",function(t){e.fireEvent("mouseleave",t),e.wavesurfer.fireEvent("region-mouseleave",e,t)}),this.element.addEventListener("click",function(t){t.preventDefault(),e.fireEvent("click",t),e.wavesurfer.fireEvent("region-click",e,t)}),this.element.addEventListener("dblclick",function(t){t.stopPropagation(),t.preventDefault(),e.fireEvent("dblclick",t),e.wavesurfer.fireEvent("region-dblclick",e,t)}),(this.drag||this.resize)&&function(){var t=e.wavesurfer.getDuration(),r,i,n,s=function(s){s.stopPropagation(),n=e.wavesurfer.drawer.handleEvent(s)*t,"handle"==s.target.tagName.toLowerCase()?i=s.target.classList.contains("wavesurfer-handle-start")?"start":"end":r=!0},a=function(t){(r||i)&&(r=!1,i=!1,t.stopPropagation(),t.preventDefault(),e.fireEvent("update-end"),e.wavesurfer.fireEvent("region-update-end"))},o=function(s){if(r||i){var a=e.wavesurfer.drawer.handleEvent(s)*t,o=a-n;n=a,e.drag&&r&&e.onDrag(o),e.resize&&i&&e.onResize(o,i)}};e.element.addEventListener("mousedown",s),e.wrapper.addEventListener("mouseup",a),e.wrapper.addEventListener("mousemove",o),e.on("remove",function(){e.wrapper.removeEventListener("mouseup",a),e.wrapper.removeEventListener("mousemove",o)})}()},onDrag:function(e){this.update({start:this.start+e,end:this.end+e})},onResize:function(e,t){this.update("start"==t?{start:Math.min(this.start+e,this.end),end:Math.max(this.start+e,this.end)}:{start:Math.min(this.end+e,this.start),end:Math.max(this.end+e,this.start)})}},WaveSurfer.util.extend(WaveSurfer.Region,WaveSurfer.Observer),WaveSurfer.initRegions=function(){this.regions||(this.regions=Object.create(WaveSurfer.Regions),this.regions.init(this))},WaveSurfer.addRegion=function(e){return this.initRegions(),this.regions.add(e)},WaveSurfer.clearRegions=function(){this.regions&&this.regions.clear()},WaveSurfer.enableDragSelection=function(e){this.initRegions(),this.regions.enableDragSelection(e)};